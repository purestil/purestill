name: PureStill Auto Post

on:
  workflow_dispatch:
  schedule:
    - cron: "0 3 * * *"   # daily UTC

jobs:
  autopost:
    runs-on: ubuntu-latest

    permissions:
      contents: write   # REQUIRED for git push

    steps:
      # 1️⃣ Checkout repo
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2️⃣ Setup Python
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # 3️⃣ Show files (debug safety)
      - name: Show repo files
        run: ls -la

      # 4️⃣ Fetch news (SAFE SCRIPT)
      - name: Fetch new content
        run: python fetch_news.py

      # 5️⃣ Generate site
      - name: Generate site
        run: python generate_pages.py

      # 6️⃣ Commit & push only if changed
      - name: Commit and push changes
        run: |
          git config user.name "purestill-bot"
          git config user.email "purestill.official@gmail.com"
          git status
          git add data.json site || true
          git diff --cached --quiet || git commit -m "Auto post update"
          git push
